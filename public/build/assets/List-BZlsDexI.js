import{r as n,j as a}from"./app-EIz8nQ5Q.js";import{X as U}from"./index.es-BsUn4GSa.js";import{i as K,j as L,k as J,J as M}from"./index-CuuF2Vom.js";import X from"./Actions-CFPk3WFN.js";import q from"./ExcelImportModal-CVonb0Xl.js";import{m as d}from"./proxy-Br4hXrCY.js";import"./iconBase-CIswt8ol.js";import"./index-BTPrMAX7.js";function te({users:r,fetchData:w,loading:j,onAdd:v,onEdit:y,onDelete:N,onView:P,onPrint:F}){const[p,S]=n.useState(""),[g,k]=n.useState(""),[m,b]=n.useState((r==null?void 0:r.current_page)||1),[u,C]=n.useState((r==null?void 0:r.per_page)||10),[x,E]=n.useState("id"),[f,T]=n.useState("asc");n.useEffect(()=>{w({page:m,perPage:u,search:p,filters:g,sortField:x,sortDirection:f})},[m,u,p,g,x,f]);const $=e=>{b(e)},_=(e,t)=>{C(e),b(t)},D=(e,t)=>{const l=["asc","desc"].includes(t)?t:"asc",i=["id","name","email","role","created_at","updated_at"].includes(e.selector)?e.selector:"id";E(i),T(l)},h=async e=>{try{const t={page:m,per_page:u,search:p,filters:educationFilter,sort_field:x,sort_direction:f},s=await axios.get(`/admin/official/${position.slug}/export/${e}`,{params:t,responseType:"blob"}),l={json:"json",excel:"xlsx",pdf:"pdf"},c={json:"application/json",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf"},i=window.URL.createObjectURL(new Blob([s.data],{type:c[e]})),o=document.createElement("a");o.href=i,o.setAttribute("download",`Pejabat_${position.slug}_${new Date().toLocaleDateString()}.${l[e]}`),document.body.appendChild(o),o.click(),o.remove(),Swal.fire("Success",`${e.toUpperCase()} exported successfully!`,"success")}catch(t){console.error(`Export ${e} error:`,t),Swal.fire("Error",`Failed to export ${e.toUpperCase()}. Please try again.`,"error")}},R=()=>h("json"),A=()=>h("excel"),H=()=>h("pdf"),O=[{name:"ID",selector:e=>e.id,sortable:!0,width:"70px"},{name:"Nama",selector:e=>e.name,sortable:!0},{name:"Email",selector:e=>e.email,sortable:!0},{name:"Daerah",selector:e=>{var t,s,l,c,i,o;return e.role==="regency"?((s=(t=e.user_regency)==null?void 0:t.regency)==null?void 0:s.name_bps)||"N/A":e.role==="district"?((c=(l=e.user_district)==null?void 0:l.district)==null?void 0:c.name_bps)||"N/A":e.role==="village"?((o=(i=e.user_village)==null?void 0:i.village)==null?void 0:o.name_bps)||"N/A":"Admin Pusat"},sortable:!0},{name:"Role",selector:e=>e.role,sortable:!0,cell:e=>a.jsx(I,{role:e.role})},{name:"Aksi",cell:e=>a.jsx(X,{row:e,onEdit:y,onDelete:N,onView:P,onPrint:F}),ignoreRowClick:!0,allowOverflow:!0,button:!0}],I=({role:e})=>{let t="",s="";switch(e){case"admin":t="bg-red-500",s="Admin";break;case"regency":t="bg-blue-500",s="Kabupaten";break;case"district":t="bg-green-500",s="Kecamatan";break;case"village":t="bg-yellow-500",s="Desa";break;default:t="bg-gray-500",s="Unknown"}return a.jsx("span",{className:`px-2 py-0 text-sm text-white rounded ${t}`,children:s})},B=async e=>{try{const t=new FormData;t.append("file",e);const s=await axios.post("/admin/user/import/excel",t,{headers:{"Content-Type":"multipart/form-data"}});return Swal.fire({icon:"success",title:"Import Berhasil!",html:`
                    <div class="text-left">
                        <p>File <strong>${e.name}</strong> berhasil diimport.</p>
                        ${s.data.inserted?`<p>Total data: <strong>${s.data.inserted}</strong></p>`:""}
                    </div>
                `,confirmButtonText:"OK",willClose:()=>{}}),s.data}catch(t){let s="Terjadi kesalahan saat mengimport file";throw t.response?s=t.response.data.message||`Error ${t.response.status}: ${t.response.statusText}`:t.request?s="Tidak ada respon dari server. Silakan coba lagi.":t.message.includes("Network Error")&&(s="Koneksi jaringan bermasalah. Periksa koneksi internet Anda."),Swal.fire({icon:"error",title:"Import Gagal",html:`
                    <div class="text-left">
                        <p>${s}</p>
                        ${e?`<p>File: <strong>${e.name}</strong></p>`:""}
                    </div>
                `,confirmButtonText:"Tutup"}),t}};return a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-300",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-4 gap-4",children:[a.jsxs("div",{className:"flex gap-4 w-full md:w-auto",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Pecarian"}),a.jsx(d.input,{type:"text",id:"search",name:"search",placeholder:"Pencarian ...",value:p,onChange:e=>S(e.target.value),className:"border p-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500 w-full md:w-auto",whileHover:{scale:1.02},whileFocus:{scale:1.02},transition:{type:"spring",stiffness:300}})]}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("label",{htmlFor:"role",className:"text-sm font-medium",children:"Role"}),a.jsxs("select",{id:"role",name:"role",value:g,onChange:e=>k(e.target.value),className:"border rounded focus:outline-none focus:ring-2 focus:ring-green-500",children:[a.jsx("option",{value:"",children:"Semua Role"}),a.jsx("option",{value:"village",children:"Village"}),a.jsx("option",{value:"district",children:"District"}),a.jsx("option",{value:"regency",children:"Regency"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[a.jsxs(d.button,{onClick:R,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(K,{className:"mr-2"})," JSON"]}),a.jsxs(d.button,{onClick:H,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(L,{className:"mr-2"})," PDF"]}),a.jsxs(d.button,{onClick:A,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(J,{className:"mr-2"})," Excel"]}),a.jsx(q,{onImport:B}),a.jsxs(d.button,{onClick:v,className:"bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(M,{className:"mr-2"})," Tambah"]})]})]}),a.jsx(U,{className:"border border-gray-300",columns:O,data:(r==null?void 0:r.data)||[],pagination:!0,paginationServer:!0,paginationTotalRows:(r==null?void 0:r.total)||0,paginationDefaultPage:m,onChangePage:$,onChangeRowsPerPage:_,onSort:D,highlightOnHover:!0,pointerOnHover:!0,striped:!0,bordered:!0,responsive:!0,progressPending:j})]})}export{te as default};
