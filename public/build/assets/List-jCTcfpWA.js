import{K as H,r as l,j as e}from"./app-cnLqKnWv.js";import{S as p}from"./sweetalert2.esm.all-LHqzTR4y.js";import{O as J,E as q,P as G,o as Q,d as V,L as W,M as X,N as Y}from"./index-sj701c6h.js";import Z from"./Actions-lCqfLVZ5.js";import z from"./ExcelImportModal-wLrqQtFH.js";import{m as k}from"./proxy-0toHJmZX.js";import"./iconBase-CMF4PMHw.js";import"./index-CoBPEikz.js";function je({officials:s,fetchData:f,loading:P,onEdit:C,onDelete:T,onView:E,onPrint:$,position:x,onAccept:ee,onReject:te,role:se}){var F;H().props.auth.user;const[m,ae]=l.useState(""),[h,re]=l.useState(""),[n,v]=l.useState((s==null?void 0:s.current_page)||1),[c,D]=l.useState((s==null?void 0:s.per_page)||10),[d,_]=l.useState("id"),[o,S]=l.useState("asc"),[ne,le]=l.useState(!1),[u,ce]=l.useState(""),[g,de]=l.useState(""),[b,oe]=l.useState("");l.useEffect(()=>{f({page:n,perPage:c,search:m,filters:h,sortField:d,sortDirection:o,kabupaten:u,kecamatan:g,desa:b})},[n,c,m,h,d,o,u,g,b]);const j=t=>v(t),K=t=>{D(Number(t.target.value)),v(1)},w=t=>{d===t?S(o==="asc"?"desc":"asc"):(_(t),S("asc"))},y=async t=>{try{const a={page:n,per_page:c,search:m,filters:h,sort_field:d,sort_direction:o,kabupaten:u,kecamatan:g,desa:b},r=await axios.get(`/admin/official/${x.slug}/export/${t}`,{params:a,responseType:"blob"}),R={json:"json",excel:"xlsx",pdf:"pdf"},B={json:"application/json",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf"},U=window.URL.createObjectURL(new Blob([r.data],{type:B[t]})),i=document.createElement("a");i.href=U,i.setAttribute("download",`Pejabat_${x.slug}_${new Date().toLocaleDateString()}.${R[t]}`),document.body.appendChild(i),i.click(),i.remove(),p.fire("Success",`${t.toUpperCase()} exported successfully!`,"success")}catch(a){console.error(`Export ${t} error:`,a),p.fire("Error",`Failed to export ${t.toUpperCase()}. Please try again.`,"error")}},M=()=>y("json"),A=()=>y("excel"),I=()=>y("pdf"),N=t=>d!==t?e.jsx(W,{className:"ml-1"}):o==="asc"?e.jsx(X,{className:"ml-1"}):e.jsx(Y,{className:"ml-1"}),L=async t=>{try{const a=new FormData;a.append("file",t);const r=await axios.post(`/admin/official/${x.slug}/import/excel`,a,{headers:{"Content-Type":"multipart/form-data"}});return p.fire({icon:"success",title:"Import Berhasil!",html:`
                <div class="text-left">
                    <p>File <strong>${t.name}</strong> berhasil diimport.</p>
                    ${r.data.inserted?`<p>Total data: <strong>${r.data.inserted}</strong></p>`:""}
                </div>
            `,confirmButtonText:"OK",willClose:()=>{}}),r.data}catch(a){let r="Terjadi kesalahan saat mengimport file";throw a.response?r=a.response.data.message||`Error ${a.response.status}: ${a.response.statusText}`:a.request?r="Tidak ada respon dari server. Silakan coba lagi.":a.message.includes("Network Error")&&(r="Koneksi jaringan bermasalah. Periksa koneksi internet Anda."),p.fire({icon:"error",title:"Import Gagal",html:`
                <div class="text-left">
                    <p>${r}</p>
                    ${t?`<p>File: <strong>${t.name}</strong></p>`:""}
                </div>
            `,confirmButtonText:"Tutup"}),a}},O=({role:t})=>{let a="",r="";switch(t){case"tolak":a="bg-red-500",r="Tolak";break;case"daftar":a="bg-blue-500",r="Daftar";break;case"validasi":a="bg-green-500",r="Terima";break;case"proses":a="bg-yellow-500",r="Proses";break;default:a="bg-gray-500",r="Tidak Diketahui"}return e.jsx("span",{className:`px-2 py-1 text-xs text-white rounded-full ${a}`,children:r})};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsx("div",{className:"flex gap-4 w-full md:w-auto"}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[e.jsxs(k.button,{onClick:M,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(J,{className:"mr-2"})," JSON"]}),e.jsxs(k.button,{onClick:I,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(q,{className:"mr-2"})," PDF"]}),e.jsxs(k.button,{onClick:A,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(G,{className:"mr-2"})," Excel"]}),e.jsx(z,{onImport:L})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-xs border",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"70px"},children:"No"}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"250px"},onClick:()=>w("nama_lengkap"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["Nama Lengkap",N("nama_lengkap")]})}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"150px"},onClick:()=>w("nik"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["NIK",N("nik")]})}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"150px"},onClick:()=>w("nipd"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["NIPD",N("nipd")]})}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Desa"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kecamatan"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kabupaten"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"120px"},children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-2 py-4 border text-center",children:"Memuat data..."})}):((F=s==null?void 0:s.data)==null?void 0:F.length)>0?s.data.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:(n-1)*c+a+1}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nama_lengkap}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nik}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nipd}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.name_dagri||"-"}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.district.name_dagri||"-"}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.district.regency.name_dagri||"-"}),e.jsx("td",{className:"border px-2 py-2 whitespace-nowrap text-sm text-gray-500 text-center",children:e.jsx(O,{role:t.status})}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:e.jsx(Z,{row:t,onEdit:C,onDelete:T,onView:E,onPrint:$})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"Tidak ada data yang ditemukan"})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-4",children:[e.jsxs("div",{className:"mb-2 md:mb-0 flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("select",{id:"rowsPerPage",value:c,onChange:K,className:"border rounded",children:[5,10,25,50,100].map(t=>e.jsx("option",{value:t,children:t},t))})}),e.jsxs("span",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:(n-1)*c+1})," ","-"," ",e.jsx("span",{className:"font-medium",children:Math.min(n*c,(s==null?void 0:s.total)||0)})," ","Total"," ",e.jsx("span",{className:"font-medium",children:(s==null?void 0:s.total)||0})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>j(n-1),disabled:n===1,className:"px-3 py-1 border rounded disabled:opacity-50 bg-green-700 text-white",children:e.jsx(Q,{})}),Array.from({length:Math.ceil(((s==null?void 0:s.total)||0)/c)},(t,a)=>a+1).slice(Math.max(0,n-3),Math.min(Math.ceil(((s==null?void 0:s.total)||0)/c),n+2)).map(t=>e.jsx("button",{onClick:()=>j(t),className:`px-3 py-1 border rounded ${n===t?"bg-green-700 text-white opacity-50":""}`,children:t},t)),e.jsx("button",{onClick:()=>j(n+1),disabled:n===Math.ceil(((s==null?void 0:s.total)||0)/c),className:"px-3 py-1 border rounded disabled:opacity-50 bg-green-700 text-white",children:e.jsx(V,{})})]})})]})]})}export{je as default};
