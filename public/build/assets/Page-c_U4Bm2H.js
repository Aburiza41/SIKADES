import{K as J,r as l,S as v,j as e,L as Q}from"./app-cnLqKnWv.js";import{S as n}from"./sweetalert2.esm.all-LHqzTR4y.js";import{A as Z}from"./AuthenticatedLayout-DtE7q2g1.js";import V from"./List-DnYeh_yT.js";import{k as ee}from"./index-CyDsHmf4.js";import R from"./Modal-9x-8vsWt.js";import{S as K}from"./react-select.esm-kjDh-dq3.js";import"./index-sj701c6h.js";import"./iconBase-CMF4PMHw.js";import"./transition-LX_87-cn.js";import"./LoadingPage-CsjTuYab.js";import"./proxy-0toHJmZX.js";import"./index-CSb7vC3W.js";import"./xlsx-5rFX-EW9.js";import"./lodash-Cij6ey_I.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-c6l4leOc.js";import"./floating-ui.dom-CHZBHl4C.js";function _e({initialVillages:I}){var A,G,P,B;const{flash:m}=J().props,[L,C]=l.useState(I),[O,f]=l.useState(!1),[E,p]=l.useState(!1),[u,j]=l.useState(!1),[D,_]=l.useState(!1),[t,w]=l.useState(null),[M,F]=l.useState([]),[H,$]=l.useState([]),[s,o]=l.useState({regency_id:null,district_id:null,code_bps:"",name_bps:"",code_dagri:"",name_dagri:"",logo:null,logo_path:"",description:"",website:"",active:!1,code:""}),[r,b]=l.useState({}),k=((A=document.querySelector('meta[name="csrf-token"]'))==null?void 0:A.getAttribute("content"))||"";l.useEffect(()=>{m!=null&&m.success&&n.fire("Success",m.success,"success"),m!=null&&m.error&&n.fire("Error",m.error,"error")},[m]),l.useEffect(()=>{fetch("/local/regencies",{headers:{Accept:"application/json"}}).then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{a.success?F(a.data):(console.error("Error fetching regencies:",a.message),n.fire("Error",a.message||"Gagal mengambil data kabupaten.","error"))}).catch(a=>{console.error("Error fetching regencies:",a),n.fire("Error","Gagal mengambil data kabupaten.","error")})},[]),l.useEffect(()=>{s.regency_id?fetch(`/local/districts/${s.regency_id.value}`,{headers:{Accept:"application/json"}}).then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{a.success?$(a.data):(console.error("Error fetching districts:",a.message),n.fire("Error",a.message||"Gagal mengambil data kecamatan.","error"))}).catch(a=>{console.error("Error fetching districts:",a),n.fire("Error","Gagal mengambil data kecamatan.","error")}):($([]),o(a=>({...a,district_id:null})))},[s.regency_id]);const S=l.useCallback(({page:a=1,perPage:c=10,search:i="",sortField:d="",sortDirection:N="",regency_id:g="",district_id:x=""})=>{f(!0),v.get("/admin/village",{page:a,per_page:c,search:i,sort_field:d,sort_direction:N,regency_id:g,district_id:x},{preserveState:!0,replace:!0,onSuccess:h=>{C(h.props.initialVillages),f(!1)},onError:()=>{n.fire("Error","Gagal mengambil data. Silakan coba lagi.","error"),f(!1)}})},[C,f]),W=()=>{j(!1),_(!1),p(!0),b({}),o({regency_id:null,district_id:null,code_bps:"",name_bps:"",code_dagri:"",name_dagri:"",logo:null,logo_path:"",description:"",website:"",active:!1,code:""})},X=a=>{v.get(`/admin/village/${a.id}/edit`,{headers:{"X-CSRF-TOKEN":k},onSuccess:c=>{var d;const i=c.props.village;w(i),j(!0),_(!1),p(!0),b({}),o({regency_id:(d=i.district)!=null&&d.regency?{value:i.district.regency.id,label:i.district.regency.name_bps}:null,district_id:i.district?{value:i.district.id,label:i.district.name_bps}:null,code_bps:i.code_bps,name_bps:i.name_bps,code_dagri:i.code_dagri,name_dagri:i.name_dagri,logo:null,logo_path:i.logo_path||"",description:i.description||"",website:i.website||"",active:i.active,code:i.code})},onError:c=>{n.fire("Error",c.error||"Gagal mengambil data desa.","error")}})},U=a=>{w(a),j(!1),_(!0),p(!0),b({})},Y=a=>{n.fire({title:"Apakah Anda yakin?",text:"Data desa ini akan dihapus!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(c=>{c.isConfirmed&&v.delete(`/admin/village/${a}`,{headers:{"X-CSRF-TOKEN":k},onSuccess:()=>{n.fire("Terhapus!","Desa berhasil dihapus.","success"),S({})},onError:i=>{n.fire("Error",i.error||"Terjadi kesalahan saat menghapus data.","error")}})})},q=()=>{const a={};return s.district_id||(a.district_id="Kecamatan wajib dipilih."),s.code_bps||(a.code_bps="Code BPS wajib diisi."),s.name_bps||(a.name_bps="Name BPS wajib diisi."),s.code_dagri||(a.code_dagri="Code DAGRI wajib diisi."),s.name_dagri||(a.name_dagri="Name DAGRI wajib diisi."),s.code||(a.code="Code wajib diisi."),s.website&&!/^https?:\/\/[^\s$.?#].[^\s]*$/.test(s.website)&&(a.website="Website harus berupa URL yang valid."),s.logo&&!["image/jpeg","image/png","image/jpg"].includes(s.logo.type)&&(a.logo="Logo harus berupa file gambar (JPEG/PNG)."),b(a),Object.keys(a).length===0},z=a=>{var N;if(a.preventDefault(),!q()){n.fire("Error","Harap isi semua kolom yang wajib.","error");return}const c=u?`/admin/village/${t.id}`:"/admin/village",i=u?"put":"post",d=new FormData;d.append("district_id",((N=s.district_id)==null?void 0:N.value)||""),d.append("code_bps",s.code_bps),d.append("name_bps",s.name_bps),d.append("code_dagri",s.code_dagri),d.append("name_dagri",s.name_dagri),s.logo&&d.append("logo",s.logo),d.append("description",s.description||""),d.append("website",s.website||""),d.append("active",s.active?"1":"0"),d.append("code",s.code),v[i](c,d,{headers:{"X-CSRF-TOKEN":k},onSuccess:()=>{n.fire("Success",`Desa ${u?"diperbarui":"ditambahkan"} berhasil.`,"success"),p(!1),b({}),S({})},onError:g=>{const x={};Object.keys(g).forEach(h=>{x[h]=g[h][0]||g[h]}),b(x),n.fire("Error",x.error||Object.values(x).join(", ")||"Terjadi kesalahan saat menyimpan data.","error")}})},y=()=>{p(!1),j(!1),_(!1),w(null),b({}),o({regency_id:null,district_id:null,code_bps:"",name_bps:"",code_dagri:"",name_dagri:"",logo:null,logo_path:"",description:"",website:"",active:!1,code:""})},T={control:a=>({...a,borderColor:"#d1d5db",borderRadius:"0.375rem",padding:"0.25rem","&:hover":{borderColor:"#3b82f6"}}),menu:a=>({...a,zIndex:9999})};return e.jsxs(Z,{header:e.jsxs("div",{className:"text-2xl font-semibold leading-tight",children:["Desa",e.jsx("p",{className:"text-sm font-thin mt-1",children:"Daftar Desa"})]}),breadcrumb:[{name:"Desa",path:"/admin/village",active:!0,icon:e.jsx(ee,{className:"w-5 h-5 mr-3"})}],children:[e.jsx(Q,{title:"Desa"}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("button",{onClick:W,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Tambah Desa"})}),e.jsx(V,{villages:L,fetchData:S,loading:O,onEdit:X,onDelete:Y,onView:U})]}),e.jsx(R,{isOpen:E&&!D,onClose:y,title:u?"Ubah Desa":"Tambah Desa",children:e.jsx("div",{className:"p-4",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Kabupaten"}),e.jsx(K,{options:M,value:s.regency_id,onChange:a=>o({...s,regency_id:a,district_id:null}),placeholder:"Pilih Kabupaten",isClearable:!0,styles:T}),r.regency_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.regency_id})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Kecamatan"}),e.jsx(K,{options:H,value:s.district_id,onChange:a=>o({...s,district_id:a}),placeholder:"Pilih Kecamatan",isClearable:!0,isDisabled:!s.regency_id,styles:T}),r.district_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.district_id})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code BPS"}),e.jsx("input",{type:"text",value:s.code_bps,onChange:a=>o({...s,code_bps:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.code_bps?"border-red-500":""}`}),r.code_bps&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.code_bps})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name BPS"}),e.jsx("input",{type:"text",value:s.name_bps,onChange:a=>o({...s,name_bps:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.name_bps?"border-red-500":""}`}),r.name_bps&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.name_bps})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code DAGRI"}),e.jsx("input",{type:"text",value:s.code_dagri,onChange:a=>o({...s,code_dagri:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.code_dagri?"border-red-500":""}`}),r.code_dagri&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.code_dagri})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name DAGRI"}),e.jsx("input",{type:"text",value:s.name_dagri,onChange:a=>o({...s,name_dagri:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.name_dagri?"border-red-500":""}`}),r.name_dagri&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.name_dagri})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Logo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>{const c=a.target.files[0];o({...s,logo:c})},className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.logo?"border-red-500":""}`}),s.logo_path&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Current: ",s.logo_path]}),r.logo&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.logo})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:a=>o({...s,description:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.description?"border-red-500":""}`,rows:"4"}),r.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Website"}),e.jsx("input",{type:"text",value:s.website,onChange:a=>o({...s,website:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.website?"border-red-500":""}`}),r.website&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.website})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Active"}),e.jsx("input",{type:"checkbox",checked:s.active,onChange:a=>o({...s,active:a.target.checked}),className:"mt-1 rounded border-gray-300"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code"}),e.jsx("input",{type:"text",value:s.code,onChange:a=>o({...s,code:a.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${r.code?"border-red-500":""}`}),r.code&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.code})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:y,className:"mr-2 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:u?"Perbarui":"Simpan"})]})]})})}),e.jsx(R,{isOpen:E&&D,onClose:y,title:"Lihat Desa",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Kabupaten"}),e.jsx("p",{className:"mt-1 text-gray-900",children:((P=(G=t==null?void 0:t.district)==null?void 0:G.regency)==null?void 0:P.name_bps)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Kecamatan"}),e.jsx("p",{className:"mt-1 text-gray-900",children:((B=t==null?void 0:t.district)==null?void 0:B.name_bps)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Desa"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.name_bps)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code Desa"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.code)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code BPS"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.code_bps)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name BPS"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.name_bps)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Code DAGRI"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.code_dagri)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name DAGRI"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.name_dagri)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Logo Path"}),e.jsx("p",{className:"mt-1 text-gray-900",children:t!=null&&t.logo_path?e.jsx("a",{href:`/storage/${t.logo_path}`,target:"_blank",className:"text-blue-500 hover:underline",children:t.logo_path}):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(t==null?void 0:t.description)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Website"}),e.jsx("p",{className:"mt-1 text-gray-900",children:t!=null&&t.website?e.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:t.website}):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Active"}),e.jsx("p",{className:"mt-1 text-gray-900",children:t!=null&&t.active?"Ya":"Tidak"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Tutup"})})]})})]})}export{_e as default};
