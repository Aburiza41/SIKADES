import{r as l,j as a}from"./app-cnLqKnWv.js";import{X as B}from"./index.es-Q68aKp3t.js";import{O as K,E as L,P as J,Q as M}from"./index-sj701c6h.js";import X from"./Actions-7mUbnnQ4.js";import q from"./ExcelImportModal-DEmaSPim.js";import{m as c}from"./proxy-0toHJmZX.js";import"./iconBase-CMF4PMHw.js";import"./index-CoBPEikz.js";function te({users:s,fetchData:w,loading:v,onAdd:j,onEdit:y,onDelete:N,onView:P,onPrint:F}){const[d,S]=l.useState(""),[m,k]=l.useState(""),[p,b]=l.useState((s==null?void 0:s.current_page)||1),[g,C]=l.useState((s==null?void 0:s.per_page)||10),[u,D]=l.useState("id"),[x,T]=l.useState("asc");l.useEffect(()=>{w({page:p,perPage:g,search:d,filters:m,sortField:u,sortDirection:x})},[p,g,d,m,u,x]);const E=e=>{b(e)},_=(e,t)=>{C(e),b(t)},$=(e,t)=>{const n=["asc","desc"].includes(t)?t:"asc",h=["id","name","email","role","created_at","updated_at"].includes(e.selector)?e.selector:"id";D(h),T(n)},f=async e=>{try{const t={page:p,per_page:g,search:d,filters:educationFilter,sort_field:u,sort_direction:x},r=await axios.get(`/admin/official/${position.slug}/export/${e}`,{params:t,responseType:"blob"}),n={json:"json",excel:"xlsx",pdf:"pdf"},o={json:"application/json",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf"},h=window.URL.createObjectURL(new Blob([r.data],{type:o[e]})),i=document.createElement("a");i.href=h,i.setAttribute("download",`Pejabat_${position.slug}_${new Date().toLocaleDateString()}.${n[e]}`),document.body.appendChild(i),i.click(),i.remove(),Swal.fire("Success",`${e.toUpperCase()} exported successfully!`,"success")}catch(t){console.error(`Export ${e} error:`,t),Swal.fire("Error",`Failed to export ${e.toUpperCase()}. Please try again.`,"error")}},A=()=>f("json"),R=()=>f("excel"),O=()=>f("pdf"),H=[{name:"ID",selector:e=>e.id,sortable:!0,width:"70px"},{name:"Nama",selector:e=>e.name,sortable:!0},{name:"Username",selector:e=>e.username,sortable:!0},{name:"Kode Daerah",selector:e=>{var t,r,n,o;return e.role==="regency"?((r=(t=e.user_regency)==null?void 0:t.regency)==null?void 0:r.code_bps)||"N/A":e.role==="village"?((o=(n=e.user_village)==null?void 0:n.village)==null?void 0:o.code_bps)||"N/A":"Admin Pusat"},sortable:!0},{name:"Daerah",selector:e=>{var t,r,n,o;return e.role==="regency"?((r=(t=e.user_regency)==null?void 0:t.regency)==null?void 0:r.name_bps)||"N/A":e.role==="village"?((o=(n=e.user_village)==null?void 0:n.village)==null?void 0:o.name_bps)||"N/A":"Admin Pusat"},sortable:!0},{name:"Role",selector:e=>e.role,sortable:!0,cell:e=>a.jsx(I,{role:e.role})},{name:"Tanggal Dibuat",selector:e=>new Date(e.created_at).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}),sortable:!0},{name:"Aksi",cell:e=>a.jsx(X,{row:e,onEdit:y,onDelete:N,onView:P,onPrint:F}),ignoreRowClick:!0,allowOverflow:!0,button:!0}],I=({role:e})=>{let t="",r="";switch(e){case"admin":t="bg-red-500",r="Admin";break;case"regency":t="bg-blue-500",r="Kabupaten";break;case"district":t="bg-green-500",r="Kecamatan";break;case"village":t="bg-yellow-500",r="Desa";break;default:t="bg-gray-500",r="Unknown"}return a.jsx("span",{className:`px-2 py-0 text-sm text-white rounded ${t}`,children:r})},U=async e=>{try{const t=new FormData;t.append("file",e);const r=await axios.post("/admin/user/import/excel",t,{headers:{"Content-Type":"multipart/form-data"}});return Swal.fire({icon:"success",title:"Import Berhasil!",html:`
                    <div class="text-left">
                        <p>File <strong>${e.name}</strong> berhasil diimport.</p>
                        ${r.data.inserted?`<p>Total data: <strong>${r.data.inserted}</strong></p>`:""}
                    </div>
                `,confirmButtonText:"OK",willClose:()=>{}}),r.data}catch(t){let r="Terjadi kesalahan saat mengimport file";throw t.response?r=t.response.data.message||`Error ${t.response.status}: ${t.response.statusText}`:t.request?r="Tidak ada respon dari server. Silakan coba lagi.":t.message.includes("Network Error")&&(r="Koneksi jaringan bermasalah. Periksa koneksi internet Anda."),Swal.fire({icon:"error",title:"Import Gagal",html:`
                    <div class="text-left">
                        <p>${r}</p>
                        ${e?`<p>File: <strong>${e.name}</strong></p>`:""}
                    </div>
                `,confirmButtonText:"Tutup"}),t}};return a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-300",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-4 gap-4",children:[a.jsxs("div",{className:"flex gap-4 w-full md:w-auto",children:[a.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[a.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Pecarian"}),a.jsx(c.input,{type:"text",id:"search",name:"search",placeholder:"Pencarian ...",value:d,onChange:e=>S(e.target.value),className:"border p-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500 w-full md:w-auto",whileHover:{scale:1.02},whileFocus:{scale:1.02},transition:{type:"spring",stiffness:300}})]}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("label",{htmlFor:"role",className:"text-sm font-medium",children:"Role"}),a.jsxs("select",{id:"role",name:"role",value:m,onChange:e=>k(e.target.value),className:"border rounded focus:outline-none focus:ring-2 focus:ring-green-500",children:[a.jsx("option",{value:"",children:"Semua Role"}),a.jsx("option",{value:"village",children:"Village"}),a.jsx("option",{value:"district",children:"District"}),a.jsx("option",{value:"regency",children:"Regency"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[a.jsxs(c.button,{onClick:A,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(K,{className:"mr-2"})," JSON"]}),a.jsxs(c.button,{onClick:O,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(L,{className:"mr-2"})," PDF"]}),a.jsxs(c.button,{onClick:R,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(J,{className:"mr-2"})," Excel"]}),a.jsx(q,{onImport:U}),a.jsxs(c.button,{onClick:j,className:"bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[a.jsx(M,{className:"mr-2"})," Tambah"]})]})]}),a.jsx(B,{className:"border border-gray-300",columns:H,data:(s==null?void 0:s.data)||[],pagination:!0,paginationServer:!0,paginationTotalRows:(s==null?void 0:s.total)||0,paginationDefaultPage:p,onChangePage:E,onChangeRowsPerPage:_,onSort:$,highlightOnHover:!0,pointerOnHover:!0,striped:!0,bordered:!0,responsive:!0,progressPending:v})]})}export{te as default};
