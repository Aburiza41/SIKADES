import{K as q,r as c,j as e}from"./app-EIz8nQ5Q.js";import{S as u}from"./sweetalert2.esm.all-LHqzTR4y.js";import{i as G,j as Q,k as V,l as W,d as X,m as Y,n as Z,o as z}from"./index-CuuF2Vom.js";import ee from"./Actions-C-yEkhj7.js";import te from"./Procces-DQeczn_0.js";import se from"./ExcelImportModal-DeTVL3SM.js";import{m as g}from"./proxy-Br4hXrCY.js";import"./iconBase-CIswt8ol.js";import"./index-BTPrMAX7.js";function me({officials:a,fetchData:v,loading:f,onEdit:S,onDelete:P,onView:F,onPrint:C,position:j,onAccept:T,onReject:$,role:ae}){var k;q().props.auth.user;const[p,D]=c.useState(""),[x,E]=c.useState(""),[n,y]=c.useState((a==null?void 0:a.current_page)||1),[l,M]=c.useState((a==null?void 0:a.per_page)||10),[d,_]=c.useState("id"),[o,N]=c.useState("asc"),A=["SD/MI","SMP/MTS","SMA/SMK/MA","D1","D2","D3","D4","S1","S2","S3"];c.useEffect(()=>{v({page:n,perPage:l,search:p,filters:x,sortField:d,sortDirection:o})},[n,l,p,x,d,o]);const b=t=>y(t),I=t=>{M(Number(t.target.value)),y(1)},m=t=>{d===t?N(o==="asc"?"desc":"asc"):(_(t),N("asc"))},w=async t=>{try{const s={page:n,per_page:l,search:p,filters:x,sort_field:d,sort_direction:o},r=await axios.get(`/admin/official/${j.slug}/export/${t}`,{params:s,responseType:"blob"}),U={json:"json",excel:"xlsx",pdf:"pdf"},H={json:"application/json",excel:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pdf:"application/pdf"},J=window.URL.createObjectURL(new Blob([r.data],{type:H[t]})),i=document.createElement("a");i.href=J,i.setAttribute("download",`Pejabat_${j.slug}_${new Date().toLocaleDateString()}.${U[t]}`),document.body.appendChild(i),i.click(),i.remove(),u.fire("Success",`${t.toUpperCase()} exported successfully!`,"success")}catch(s){console.error(`Export ${t} error:`,s),u.fire("Error",`Failed to export ${t.toUpperCase()}. Please try again.`,"error")}},K=()=>w("json"),L=()=>w("excel"),R=()=>w("pdf"),h=t=>d!==t?e.jsx(Y,{className:"ml-1"}):o==="asc"?e.jsx(Z,{className:"ml-1"}):e.jsx(z,{className:"ml-1"}),B=async t=>{try{const s=new FormData;s.append("file",t);const r=await axios.post(`/admin/official/${j.slug}/import/excel`,s,{headers:{"Content-Type":"multipart/form-data"}});return u.fire({icon:"success",title:"Import Berhasil!",html:`
                <div class="text-left">
                    <p>File <strong>${t.name}</strong> berhasil diimport.</p>
                    ${r.data.inserted?`<p>Total data: <strong>${r.data.inserted}</strong></p>`:""}
                </div>
            `,confirmButtonText:"OK",willClose:()=>{}}),r.data}catch(s){let r="Terjadi kesalahan saat mengimport file";throw s.response?r=s.response.data.message||`Error ${s.response.status}: ${s.response.statusText}`:s.request?r="Tidak ada respon dari server. Silakan coba lagi.":s.message.includes("Network Error")&&(r="Koneksi jaringan bermasalah. Periksa koneksi internet Anda."),u.fire({icon:"error",title:"Import Gagal",html:`
                <div class="text-left">
                    <p>${r}</p>
                    ${t?`<p>File: <strong>${t.name}</strong></p>`:""}
                </div>
            `,confirmButtonText:"Tutup"}),s}},O=({role:t})=>{let s="",r="";switch(t){case"tolak":s="bg-red-500",r="Tolak";break;case"daftar":s="bg-blue-500",r="Daftar";break;case"validasi":s="bg-green-500",r="Terima";break;case"proses":s="bg-yellow-500",r="Proses";break;default:s="bg-gray-500",r="Tidak Diketahui"}return e.jsx("span",{className:`px-2 py-1 text-xs text-white rounded-full ${s}`,children:r})};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg border border-gray-300",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-4 w-full md:w-auto",children:[e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsx("label",{htmlFor:"search",className:"text-sm font-medium",children:"Pecarian"}),e.jsx(g.input,{type:"text",id:"search",name:"search",placeholder:"Pencarian ...",value:p,onChange:t=>D(t.target.value),className:"border p-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500 w-full md:w-auto",whileHover:{scale:1.02},whileFocus:{scale:1.02},transition:{type:"spring",stiffness:300}})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"education",className:"text-sm font-medium",children:"Pendidikan"}),e.jsxs("select",{id:"education",name:"education",value:x,onChange:t=>E(t.target.value),className:"border rounded focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"Semua"}),A.map((t,s)=>e.jsx("option",{value:t,children:t},s))]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[e.jsxs(g.button,{onClick:K,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(G,{className:"mr-2"})," JSON"]}),e.jsxs(g.button,{onClick:R,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(Q,{className:"mr-2"})," PDF"]}),e.jsxs(g.button,{onClick:L,className:"bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:300},children:[e.jsx(V,{className:"mr-2"})," Excel"]}),e.jsx(se,{onImport:B})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-xs border",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"70px"},children:"No"}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"250px"},onClick:()=>m("nama_lengkap"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["Nama Lengkap",h("nama_lengkap")]})}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"150px"},onClick:()=>m("nik"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["NIK",h("nik")]})}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"150px"},onClick:()=>m("nipd"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["NIPD",h("nipd")]})}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"150px"},onClick:()=>m("pendidikan"),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:["Pendidikan",h("pendidikan")]})}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Desa"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kecamatan"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kabupaten"}),e.jsx("th",{className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"120px"},children:"Proses"}),e.jsx("th",{scope:"col",className:"px-2 py-2 border text-left text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:"120px"},children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-2 py-4 border text-center",children:"Memuat data..."})}):((k=a==null?void 0:a.data)==null?void 0:k.length)>0?a.data.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:(n-1)*l+s+1}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nama_lengkap}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nik}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.nipd}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.identities.pendidikan||"-"}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.name_bps||"-"}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.district.name_bps||"-"}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:t.village.district.regency.name_bps||"-"}),e.jsx("td",{className:"border px-2 py-2 whitespace-nowrap text-sm text-gray-500 text-center",children:e.jsx(O,{role:t.status})}),e.jsx("td",{className:"border px-2 py-2 whitespace-nowrap text-sm text-gray-500 text-center",children:e.jsx(te,{row:t,onAccept:T,onReject:$})}),e.jsx("td",{className:"px-2 py-2 border whitespace-nowrap",children:e.jsx(ee,{row:t,onEdit:S,onDelete:P,onView:F,onPrint:C})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"Tidak ada data yang ditemukan"})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-4",children:[e.jsxs("div",{className:"mb-2 md:mb-0 flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("select",{id:"rowsPerPage",value:l,onChange:I,className:"border rounded",children:[5,10,25,50,100].map(t=>e.jsx("option",{value:t,children:t},t))})}),e.jsxs("span",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:(n-1)*l+1})," ","-"," ",e.jsx("span",{className:"font-medium",children:Math.min(n*l,(a==null?void 0:a.total)||0)})," ","Total"," ",e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.total)||0})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(n-1),disabled:n===1,className:"px-3 py-1 border rounded disabled:opacity-50 bg-green-700 text-white",children:e.jsx(W,{})}),Array.from({length:Math.ceil(((a==null?void 0:a.total)||0)/l)},(t,s)=>s+1).slice(Math.max(0,n-3),Math.min(Math.ceil(((a==null?void 0:a.total)||0)/l),n+2)).map(t=>e.jsx("button",{onClick:()=>b(t),className:`px-3 py-1 border rounded ${n===t?"bg-green-700 text-white opacity-50":""}`,children:t},t)),e.jsx("button",{onClick:()=>b(n+1),disabled:n===Math.ceil(((a==null?void 0:a.total)||0)/l),className:"px-3 py-1 border rounded disabled:opacity-50 bg-green-700 text-white",children:e.jsx(X,{})})]})})]})]})}export{me as default};
