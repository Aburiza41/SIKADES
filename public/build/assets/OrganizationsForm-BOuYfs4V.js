import{r as f,j as e,a as J}from"./app-cnLqKnWv.js";import{f as S,H as A,a as z,g as T,b as K,c as F,h as $,i as P,j as V,d as X,e as Y}from"./index-CyDsHmf4.js";import{b as M}from"./index-sj701c6h.js";import{S as q}from"./react-select.esm-kjDh-dq3.js";import{S as b}from"./sweetalert2.esm.all-LHqzTR4y.js";import{m as t}from"./proxy-0toHJmZX.js";import{A as Q}from"./index-CSb7vC3W.js";import"./iconBase-CMF4PMHw.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-c6l4leOc.js";import"./floating-ui.dom-CHZBHl4C.js";const W={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,when:"beforeChildren",staggerChildren:.1}}},c={hidden:{opacity:0,x:-10},visible:{opacity:1,x:0,transition:{duration:.3}},focus:{scale:1.02,boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.5)"}},B={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3}}},I=(g,y)=>{if(!g||!y)return"-";const o=new Date(g),p=new Date(y);if(isNaN(o.getTime()))return"Tanggal mulai tidak valid";if(isNaN(p.getTime()))return"Tanggal selesai tidak valid";const v=p-o,d=Math.floor(v/(1e3*60*60*24));if(d<0)return"Tanggal tidak valid";const u=Math.floor(d/365),j=Math.floor(d%365/30),m=d%30;let l=[];return u>0&&l.push(`${u} tahun`),j>0&&l.push(`${j} bulan`),m>0&&u<1&&l.push(`${m} hari`),l.length>0?l.join(" "):"Kurang dari 1 hari"};function me({organizations:g=[],setOrganizations:y=()=>{},officialOrganizations:o=[],setOfficialOrganizations:p=()=>{}}){const[v,d]=f.useState(!1),[u,j]=f.useState(""),[m,l]=f.useState(null),[i,x]=f.useState({nama:"",posisi:"",mulai:"",selesai:"",pimpinan:"",tempat:"",docScan:null}),[N,k]=f.useState(null),[O,_]=f.useState([]),D=[...g.map(a=>({value:a.id,label:a.title})),...O],C=(a=null)=>{if(a!==null){const s=o[a];l({value:s.organization_id,label:s.organization_title}),x({nama:s.nama,posisi:s.posisi,mulai:s.mulai,selesai:s.selesai,pimpinan:s.pimpinan,tempat:s.tempat,docScan:s.doc_scan||null}),k(a)}else l(null),x({nama:"",posisi:"",mulai:"",selesai:"",pimpinan:"",tempat:"",docScan:null}),k(null);d(!0)},H=()=>{d(!1),l(null),x({nama:"",posisi:"",mulai:"",selesai:"",pimpinan:"",tempat:"",docScan:null}),k(null)},h=a=>{const{name:s,value:n}=a.target;x(r=>({...r,[s]:n}))},E=()=>{if(!m||!i.nama||!i.posisi){b.fire({icon:"error",title:"Oops...",text:"Harap isi semua field yang diperlukan!"});return}const a={organization_id:m.value,organization_title:m.label,...i,doc_scan:i.docScan};if(N!==null){const s=[...o];s[N]=a,p(s),w("Data organisasi berhasil diperbarui.")}else p([...o,a]),w("Data organisasi berhasil ditambahkan.");H()},w=a=>{b.fire({title:"Berhasil!",text:a,icon:"success",iconColor:"#10b981",confirmButtonColor:"#3b82f6",background:"#ffffff"})},R=a=>{b.fire({title:"Apakah Anda yakin?",text:"Data yang dihapus tidak dapat dikembalikan!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3b82f6",cancelButtonColor:"#ef4444",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal",background:"#ffffff",iconColor:"#f59e0b"}).then(s=>{if(s.isConfirmed){const n=o.filter((r,U)=>U!==a);p(n),w("Data telah dihapus.")}})},G=async a=>{if(D.some(n=>n.label.toLowerCase()===a.toLowerCase())){b.fire({icon:"info",title:"Organisasi sudah ada",text:"Organisasi ini sudah tersedia di daftar pilihan"});return}try{const n=await J.post("/village/official/organization/store",{title:a,description:"Ditambahkan secara otomatis dari input pencarian"});if(n.data.success){const r={id:n.data.data.id,title:n.data.data.title,description:n.data.data.description};y([...g,r]),l({value:r.id,label:r.title}),w("Organisasi baru berhasil ditambahkan")}}catch(n){console.error("Gagal menambahkan organisasi:",n);const r={label:a,value:`temp-${Date.now()}`};_([...O,r]),l(r),b.fire({icon:"warning",title:"Organisasi ditambahkan sementara",text:"Organisasi ini belum tersimpan di database. Silakan tambahkan melalui menu 'Jenis Organisasi' untuk menyimpan permanen."})}},L=a=>{if(a.target.files&&a.target.files.length>0){const s=a.target.files[0];if(!["application/pdf","image/jpeg","image/png"].includes(s.type)){alert("Hanya file PDF, JPEG, atau PNG yang diizinkan");return}if(s.size>5*1024*1024){alert("Ukuran file maksimal 5MB");return}x(r=>({...r,docScan:s}))}};return e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white w-full p-6 shadow-lg rounded-xl mt-8 border border-gray-100",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:.5},children:e.jsx(S,{className:"text-3xl text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"D. KEANGGOTAAN ORGANISASI"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1 flex items-center",children:[e.jsx(A,{className:"mr-1 text-blue-500"}),"Formulir ini digunakan untuk mengisi riwayat organisasi pejabat desa."]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(t.button,{type:"button",onClick:()=>C(),whileHover:{scale:1.03},whileTap:{scale:.98},className:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 flex items-center text-sm font-medium shadow-md",children:[e.jsx(z,{className:"mr-2 text-lg"})," Tambah Riwayat"]})})]}),e.jsx(t.div,{variants:W,initial:"hidden",animate:"visible",className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organisasi"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nama"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Posisi"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dokumen"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lama Jabatan"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pimpinan"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tempat"}),e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length>0?o.map((a,s)=>e.jsxs(t.tr,{className:"hover:bg-gray-50",variants:B,children:[e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.organization_title}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.nama}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.posisi}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.doc_scan?e.jsxs("a",{href:URL.createObjectURL(a.doc_scan),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(T,{className:"mr-1"}),"Lihat"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:I(a.mulai,a.selesai)}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.pimpinan||"-"}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm text-gray-800",children:a.tempat||"-"}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(t.button,{type:"button",onClick:()=>C(s),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-3 py-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-lg hover:from-amber-600 hover:to-amber-700 flex items-center text-xs shadow-sm",children:[e.jsx(K,{className:"mr-1"})," ","Edit"]}),e.jsxs(t.button,{type:"button",onClick:()=>R(s),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 flex items-center text-xs shadow-sm",children:[e.jsx(F,{className:"mr-1"})," ","Hapus"]})]})})]},s)):e.jsx(t.tr,{variants:B,children:e.jsx("td",{colSpan:"8",className:"px-2 py-2 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[e.jsx(A,{className:"text-4xl mb-2 text-blue-200"}),e.jsx("p",{className:"text-sm font-medium",children:"Tidak ada data riwayat organisasi."}),e.jsxs(t.button,{type:"button",onClick:()=>C(),whileHover:{scale:1.03},whileTap:{scale:.98},className:"mt-4 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 flex items-center text-sm font-medium shadow-md",children:[e.jsx(z,{className:"mr-2"})," ","Tambah Riwayat"]})]})})})})]})})]}),e.jsx(Q,{children:v&&e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx(t.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{type:"spring",damping:25},className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e.jsx(S,{className:"mr-2 text-blue-500"}),N!==null?"Edit Riwayat Organisasi":"Tambah Riwayat Organisasi"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"col-span-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx($,{className:"mr-2 text-blue-500"}),"Jenis Organisasi"]}),e.jsx(t.div,{whileFocus:"focus",variants:c,children:e.jsx(q,{options:D,value:m,onChange:l,onInputChange:j,onKeyDown:a=>{a.key==="Enter"&&u.trim()&&(G(u),a.preventDefault())},placeholder:"Pilih Organisasi atau ketik untuk menambahkan baru",isClearable:!0,isSearchable:!0,noOptionsMessage:()=>"Tidak ada opsi, tekan Enter untuk menambahkan",className:"basic-single",classNamePrefix:"select",styles:{control:a=>({...a,minHeight:"42px",borderColor:"#d1d5db","&:hover":{borderColor:"#d1d5db"},borderRadius:"0.5rem",boxShadow:"none","&:focus-within":{boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.5)",borderColor:"transparent"}})}})})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.2},children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(S,{className:"mr-2 text-blue-500"}),"Nama Organisasi"]}),e.jsx(t.input,{type:"text",name:"nama",value:i.nama,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Nama",whileFocus:"focus",variants:c})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.3},children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(M,{className:"mr-2 text-blue-500"}),"Kedudukan/Jabatan"]}),e.jsx(t.input,{type:"text",name:"posisi",value:i.posisi,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Posisi",whileFocus:"focus",variants:c})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.4},className:"col-span-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(P,{className:"mr-2 text-blue-500"}),"Tanggal Mulai"]}),e.jsx(t.input,{type:"date",name:"mulai",value:i.mulai,onChange:a=>{h(a),i.selesai||x(s=>({...s,selesai:a.target.value}))},max:i.selesai,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",whileFocus:"focus",variants:c})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.5},className:"col-span-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(P,{className:"mr-2 text-blue-500"}),"Tanggal Selesai"]}),e.jsx(t.input,{type:"date",name:"selesai",value:i.selesai,onChange:h,min:i.mulai,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",whileFocus:"focus",variants:c})]}),e.jsx(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.6},className:"col-span-2",children:e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsxs("span",{className:"font-medium",children:["Durasi:"," "]}),I(i.mulai,i.selesai)]})}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.7},children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(M,{className:"mr-2 text-blue-500"}),"Nama Pimpinan"]}),e.jsx(t.input,{type:"text",name:"pimpinan",value:i.pimpinan,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Pimpinan",whileFocus:"focus",variants:c})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.8},children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(V,{className:"mr-2 text-blue-500"}),"Tempat"]}),e.jsx(t.input,{type:"text",name:"tempat",value:i.tempat,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Tempat",whileFocus:"focus",variants:c})]}),e.jsxs(t.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.9},className:"col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(T,{className:"mr-2 text-blue-500"}),"Dokumen"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.input,{type:"file",onChange:L,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.jpg,.jpeg,.png",whileFocus:"focus",variants:c}),i.docScan&&e.jsx("button",{onClick:()=>x(a=>({...a,docScan:null})),className:"p-2 text-red-500 hover:text-red-700",title:"Hapus dokumen",children:e.jsx(F,{})})]}),i.docScan&&e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-600",children:[e.jsx(T,{className:"mr-2"}),e.jsx("span",{children:i.docScan.name}),e.jsxs("span",{className:"ml-2 text-gray-400",children:["(",(i.docScan.size/1024).toFixed(1)," ","KB)"]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsxs(t.button,{type:"button",onClick:H,whileHover:{scale:1.03},whileTap:{scale:.98},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx(X,{className:"mr-2"})," Batal"]}),e.jsxs(t.button,{type:"button",onClick:E,whileHover:{scale:1.03},whileTap:{scale:.98},className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-colors flex items-center shadow-md",children:[e.jsx(Y,{className:"mr-2"}),N!==null?"Simpan Perubahan":"Simpan"]})]})]})})})})]})}export{me as default};
