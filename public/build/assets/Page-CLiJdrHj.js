import{K as G,r,S as y,j as e,L as Y}from"./app-cnLqKnWv.js";import{S as i}from"./sweetalert2.esm.all-LHqzTR4y.js";import{A as z}from"./AuthenticatedLayout-DtE7q2g1.js";import Q from"./List-Co4efPRu.js";import _ from"./Modal-kjMMQtwV.js";import{a as W,m as Z}from"./index-CyDsHmf4.js";import"./index-sj701c6h.js";import"./iconBase-CMF4PMHw.js";import"./transition-LX_87-cn.js";import"./LoadingPage-CsjTuYab.js";import"./proxy-0toHJmZX.js";import"./index-CSb7vC3W.js";import"./xlsx-5rFX-EW9.js";var L;const I=((L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.getAttribute("content"))||"";function xe({positions:D,sort:M,search:T}){var E;const{flash:o}=G().props,[q,B]=r.useState(D),[O,b]=r.useState(!1),[f,A]=r.useState(M||{}),[k,F]=r.useState(T||""),[N,m]=r.useState(!1),[d,x]=r.useState(!1),[w,g]=r.useState(!1),[s,h]=r.useState(null),[K,V]=r.useState([]),[j,S]=r.useState(!1),[t,n]=r.useState({name:"",slug:"",description:"",min:0,max:1,level:1,parent_id:"",keterangan:""});r.useEffect(()=>{o!=null&&o.success&&i.fire("Success",o.success,"success"),o!=null&&o.error&&i.fire("Error",o.error,"error")},[o]);const C=r.useCallback(async()=>{S(!0);try{const a=await fetch("/local/positions");if(!a.ok)throw new Error("Failed to fetch positions");const l=await a.json();let c=l.data||l||[];d&&s&&(c=c.filter(u=>u.id!==s.id)),c=c.filter(u=>u.level<3),V(c)}catch(a){console.error("Error fetching parent positions:",a),i.fire("Error","Gagal memuat data jabatan induk","error")}finally{S(!1)}},[d,s]),v=r.useCallback((a={})=>{b(!0),y.get("/admin/positions",{page:a.page||1,per_page:a.perPage||10,search:a.search||k,sort_field:a.sortField||f.sort_field,sort_direction:a.sortDirection||f.sort_direction},{preserveState:!0,replace:!0,onSuccess:l=>{B(l.props.positions),A(l.props.sort||{}),F(l.props.search||""),b(!1)},onError:()=>{i.fire("Error","Failed to fetch data. Please try again.","error"),b(!1)}})},[k,f]),$=async()=>{x(!1),g(!1),m(!0),h(null),await C(),n({name:"",slug:"",description:"",min:0,max:1,level:1,parent_id:"",keterangan:""})},H=async a=>{h(a),x(!0),g(!1),m(!0),await C(),n({name:a.name||"",slug:a.slug||"",description:a.description||"",min:a.min||0,max:a.max||1,level:a.level||1,parent_id:a.parent_id||"",keterangan:a.keterangan||""})},R=a=>{h(a),x(!1),g(!0),m(!0)},P=a=>{i.fire({title:"Apakah Anda yakin?",text:"Jabatan ini akan dihapus permanen!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(l=>{l.isConfirmed&&y.delete(`/admin/positions/${a}`,{headers:{"X-CSRF-TOKEN":I},onSuccess:()=>{i.fire("Terhapus!","Jabatan berhasil dihapus.","success"),v({})},onError:()=>{i.fire("Error","Terjadi kesalahan saat menghapus jabatan.","error")}})})},U=a=>{if(a.preventDefault(),parseInt(t.min)>=parseInt(t.max)){i.fire("Error","Nilai maksimal harus lebih besar dari nilai minimal","error");return}if(parseInt(t.level)<1||parseInt(t.level)>99){i.fire("Error","Level harus antara 1 dan 99","error");return}const l=d?`/admin/positions/${s.id}`:"/admin/positions",c=d?"put":"post",u={name:t.name,slug:t.slug,description:t.description,min:parseInt(t.min),max:parseInt(t.max),level:parseInt(t.level),parent_id:t.parent_id||null,keterangan:t.keterangan};y[c](l,u,{headers:{"X-CSRF-TOKEN":I},onSuccess:()=>{i.fire("Success",`Jabatan ${d?"diperbarui":"ditambahkan"} berhasil.`,"success"),m(!1),v({})},onError:J=>{J.errors?i.fire("Error",Object.values(J.errors).join(", "),"error"):i.fire("Error","Terjadi kesalahan saat menyimpan data.","error")}})},p=()=>{m(!1),x(!1),g(!1),h(null),n({name:"",slug:"",description:"",min:0,max:1,level:1,parent_id:"",keterangan:""})},X=a=>a.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return r.useEffect(()=>{!d&&t.name&&!t.slug&&n(a=>({...a,slug:X(a.name)}))},[t.name,d]),e.jsxs(z,{header:e.jsxs("div",{className:"text-2xl font-semibold leading-tight",children:["Jabatan",e.jsx("p",{className:"text-sm font-thin mt-1",children:"Daftar Jabatan Pegawai"})]}),breadcrumb:[{name:"Jabatan",path:"/admin/positions",active:!0,icon:e.jsx(Z,{className:"w-5 h-5 mr-3"})}],children:[e.jsx(Y,{title:"Jabatan"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{}),e.jsxs("button",{onClick:$,className:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Tambah Jabatan"]})]}),e.jsx(Q,{positions:q,fetchData:v,loading:O,onEdit:H,onDelete:P,onView:R})]}),e.jsx(_,{isOpen:N&&!w,onClose:p,title:d?"Edit Jabatan":"Tambah Jabatan",children:e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nama Jabatan *"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>n({...t,name:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Slug *"}),e.jsx("input",{type:"text",value:t.slug,onChange:a=>n({...t,slug:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Deskripsi *"}),e.jsx("input",{type:"text",value:t.description,onChange:a=>n({...t,description:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Minimal *"}),e.jsx("input",{type:"number",min:"0",value:t.min,onChange:a=>n({...t,min:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Maksimal *"}),e.jsx("input",{type:"number",min:"1",value:t.max,onChange:a=>n({...t,max:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Level *"}),e.jsx("input",{type:"number",min:"1",max:"99",value:t.level,onChange:a=>n({...t,level:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Jabatan Induk"}),e.jsxs("select",{value:t.parent_id,onChange:a=>n({...t,parent_id:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",disabled:j,children:[e.jsx("option",{value:"",children:"-- Pilih Jabatan Induk --"}),j?e.jsx("option",{value:"",disabled:!0,children:"Memuat data..."}):K.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (Level ",a.level,")"]},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hanya menampilkan jabatan dengan level kurang dari 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Keterangan"}),e.jsx("input",{type:"text",value:t.keterangan,onChange:a=>n({...t,keterangan:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition duration-200",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200",disabled:j,children:d?"Update":"Simpan"})]})]})})}),e.jsx(_,{isOpen:N&&w,onClose:p,title:"Detail Jabatan",children:e.jsxs("div",{className:"p-4 space-y-4 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nama Jabatan"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Slug"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.slug)||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.description)||"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Minimal"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.min)||"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Maksimal"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.max)||"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Level"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.level)||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Jabatan Induk"}),e.jsxs("p",{className:"mt-1 text-gray-900",children:[((E=s==null?void 0:s.parent)==null?void 0:E.name)||"-",(s==null?void 0:s.parent)&&` (Level ${s.parent.level})`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Keterangan"}),e.jsx("p",{className:"mt-1 text-gray-900",children:(s==null?void 0:s.keterangan)||"-"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition duration-200",children:"Tutup"})})]})})]})}export{xe as default};
